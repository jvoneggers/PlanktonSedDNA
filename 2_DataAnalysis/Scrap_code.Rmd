



V9
```{r}
nmds <- ps_V9_norm %>% subset_taxa(.,Family %in% c("Branchiopoda", "Maxillopoda")) %>% tax_glom(., taxrank = "Genus") %>% ordinate(., method = "NMDS", distance="bray")
#nmds <- ps_V9_norm %>% subset_taxa(.,Family %in% c("Branchiopoda", "Maxillopoda")) %>% ordinate(., method = "NMDS", distance="bray")
nmds_points <- as.data.frame(nmds$points)
nmds_points$sample_id<-rownames(nmds_points)
nmds_meta<-merge(nmds_points,metadata,by="sample_id")
rm(nmds_points)


lake_colors <- c("Canyon" = "#b9ceac", "Eyrie" = "darkolivegreen3", "Lightning" = "darkolivegreen", 
                 "Black Rock" = "#FFBBFF", "Footprint" = "#CD96CD", "Lost" = "#9696CD", 
                 "Scott" = "#5D478B", "Bullfrog" = "#1E90FF", "Middle Gaylor" = "#8EE5EE", 
                 "Soldier" = "#4682B4", "Skelton" = "#5F9EA0", "Crescent" = "#EE6363", 
                 "Louise" = "#FFA07A", "Monogram" = "#EE30A7")
                 

nmds_meta<-nmds_meta %>%
        arrange(state,mountain_range, fish, lake_name,bottom_cm) %>%
        group_by(lake_name)%>%
        mutate(fish_present_sample = ifelse(first_stocked_yr>=date_mid_AD_combo | is.na(first_stocked_yr) ==T, "fishless","fish"))  %>%  
        mutate(fish_present_sample = if_else(!is.na(fish_disappear_or_eradicated) & fish_disappear_or_eradicated <= date_mid_AD_combo, "fishless", fish_present_sample)) %>% ungroup()


nmds_meta <- nmds_meta %>%
  mutate(lake_color = lake_colors[lake_name], 
        fish_col = if_else(fish_present_sample == "fish", "black", lake_color))

legend_cols<-unique(nmds_meta[,names(nmds_meta)%in%c("lake_name","lake_color")])


# add depth
nmds_meta$scaled_depth<-scale(nmds_meta$bottom_cm)
nmds_meta$scaled_depth<-(nmds_meta$scaled_depth+2.519536)

# plot
#png("3_Figures/FigX_NMDS_zooplankton_V9_ESV.png", height= 7, width=13, units = "in", res = 400)
png("3_Figures/FigX_NMDS_zooplankton_V9_genus.png", height= 7, width=13, units = "in", res = 400)
par(mar=c(4,4,1,10),xpd=TRUE)
plot(nmds_meta$MDS1, nmds_meta$MDS2,pch =21, bg=nmds_meta$lake_color,col=nmds_meta$fish_col,ylab="",xlab="", cex=nmds_meta$scaled_depth)

legend("topright", legend = legend_cols$lake_name, col = legend_cols$lake_color, pch = 21, pt.bg = legend_cols$lake_color, title = "Lake", bty = "n", pt.cex=2,cex = 1.1, inset = c(-0.18, 0))
# 
legend("topright", legend = c("Fish present","Fishless"), col = c("black","white"), pch = 21, pt.bg =   "#FDBF6F", title = "", bty = "n", pt.cex=2,cex = 1.1, inset = c(-.19, 0.6))
 title(xlab="NMDS1", line = 2.5, cex.lab=1.2)
 title(ylab="NMDS2", line = 2.5, cex.lab=1.2)
dev.off()

```

V7
```{r}
nmds <- ps_V7_norm %>% subset_taxa(.,Family %in% c("Branchiopoda", "Maxillopoda")) %>% tax_glom(., taxrank = "Genus") %>% ordinate(., method = "NMDS", distance="bray")
#nmds <- ps_V9_norm %>% subset_taxa(.,Family %in% c("Branchiopoda", "Maxillopoda")) %>% ordinate(., method = "NMDS", distance="bray")
nmds_points <- as.data.frame(nmds$points)
nmds_points$sample_id<-rownames(nmds_points)
nmds_meta<-merge(nmds_points,metadata,by="sample_id")
rm(nmds_points)


lake_colors <- c("Canyon" = "#b9ceac", "Eyrie" = "darkolivegreen3", "Lightning" = "darkolivegreen", 
                 "Black Rock" = "#FFBBFF", "Footprint" = "#CD96CD", "Lost" = "#9696CD", 
                 "Scott" = "#5D478B", "Bullfrog" = "#1E90FF", "Middle Gaylor" = "#8EE5EE", 
                 "Soldier" = "#4682B4", "Skelton" = "#5F9EA0", "Crescent" = "#EE6363", 
                 "Louise" = "#FFA07A", "Monogram" = "#EE30A7")
                 

nmds_meta<-nmds_meta %>%
        arrange(state,mountain_range, fish, lake_name,bottom_cm) %>%
        group_by(lake_name)%>%
        mutate(fish_present_sample = ifelse(first_stocked_yr>=date_mid_AD_combo | is.na(first_stocked_yr) ==T, "fishless","fish"))  %>%  
        mutate(fish_present_sample = if_else(!is.na(fish_disappear_or_eradicated) & fish_disappear_or_eradicated <= date_mid_AD_combo, "fishless", fish_present_sample)) %>% ungroup()


nmds_meta <- nmds_meta %>%
  mutate(lake_color = lake_colors[lake_name], 
        fish_col = if_else(fish_present_sample == "fish", "black", lake_color))

legend_cols<-unique(nmds_meta[,names(nmds_meta)%in%c("lake_name","lake_color")])


# add depth
nmds_meta$scaled_depth<-scale(nmds_meta$bottom_cm)
nmds_meta$scaled_depth<-(nmds_meta$scaled_depth+2.519536)

# plot
#png("3_Figures/FigX_NMDS_zooplankton_V7_ESV.png", height= 7, width=13, units = "in", res = 400)
png("3_Figures/FigX_NMDS_zooplankton_V7_genus.png", height= 7, width=13, units = "in", res = 400)
par(mar=c(4,4,1,10),xpd=TRUE)
plot(nmds_meta$MDS1, nmds_meta$MDS2,pch =21, bg=nmds_meta$lake_color,col=nmds_meta$fish_col,ylab="",xlab="", cex=nmds_meta$scaled_depth)

legend("topright", legend = legend_cols$lake_name, col = legend_cols$lake_color, pch = 21, pt.bg = legend_cols$lake_color, title = "Lake", bty = "n", pt.cex=2,cex = 1.1, inset = c(-0.18, 0))
# 
legend("topright", legend = c("Fish present","Fishless"), col = c("black","white"), pch = 21, pt.bg =   "#FDBF6F", title = "", bty = "n", pt.cex=2,cex = 1.1, inset = c(-.19, 0.6))
 title(xlab="NMDS1", line = 2.5, cex.lab=1.2)
 title(ylab="NMDS2", line = 2.5, cex.lab=1.2)
dev.off()

```

V7
```{r}
#nmds <- ps_V7_norm %>% subset_taxa(.,Family %in% c("Branchiopoda", "Maxillopoda")) %>% ordinate(., method = "NMDS", distance="bray")
nmds <- ps_V7_norm %>% subset_taxa(.,Family %in% c("Branchiopoda", "Maxillopoda")) %>% tax_glom(., taxrank = "Genus") %>% ordinate(., method = "NMDS", distance="bray")


nmds_points <- as.data.frame(nmds$points)
nmds_points$sample_id<-rownames(nmds_points)
nmds_meta<-merge(nmds_points,metadata,by="sample_id")
rm(nmds_points)


# lake_colors <- c(
#   "Canyon" = "gray88", 
#   "Eyrie" = "gray88", 
#   "Lightning" = "gray88", 
#   "Black Rock" = "#FFBBFF", 
#   "Footprint" = "#CD96CD", 
#   "Lost" = "#9696CD", 
#   "Scott" = "#5D478B", 
#   "Bullfrog" = "#1E90FF", 
#   "Middle Gaylor" = "#8EE5EE", 
#   "Soldier" = "gray88", 
#   "Skelton" = "gray88", 
#   "Crescent" = "gray88", 
#   "Louise" = "#FFA07A", 
#   "Monogram" = "#EE30A7"
# )



lake_colors <- c("Canyon" = "#b9ceac", "Eyrie" = "darkolivegreen3", "Lightning" = "darkolivegreen",
                 "Black Rock" = "gray88", "Footprint" = "gray88", "Lost" = "gray88",
                 "Scott" = "gray88", "Bullfrog" = "gray88", "Middle Gaylor" = "gray88",
                 "Soldier" = "#4682B4", "Skelton" = "#5F9EA0", "Crescent" = "#EE6363",
                 "Louise" = "gray88", "Monogram" = "gray88")


nmds_meta<-nmds_meta %>%
        arrange(state,mountain_range, fish, lake_name,bottom_cm) %>%
        group_by(lake_name)%>%
        mutate(fish_present_sample = ifelse(first_stocked_yr>=date_mid_AD_combo | is.na(first_stocked_yr) ==T, "fishless","fish"))  %>%  
        mutate(fish_present_sample = if_else(!is.na(fish_disappear_or_eradicated) & fish_disappear_or_eradicated <= date_mid_AD_combo, "fishless", fish_present_sample)) %>% ungroup()

nmds_meta <- nmds_meta %>%
        mutate(lake_color = lake_colors[lake_name])

# add depth
nmds_meta$scaled_depth<-scale(nmds_meta$bottom_cm)
nmds_meta$scaled_depth<-(nmds_meta$scaled_depth+2.519536)



ggplot() +
  geom_point(data = nmds_meta %>% filter(fish == 1), 
             aes(x = MDS1, y = MDS2, size = scaled_depth, color=lake_name), 
            shape = 16) +  
  geom_point(data = nmds_meta %>% filter(fish == 0), 
             aes(x = MDS1, y = MDS2, size = scaled_depth, color = lake_name), 
             shape = 16) +  
  scale_color_manual(values = lake_colors, name = "Lake") +  
  scale_size_continuous(name = "Scaled Depth", range = c(1, 5), guide = "none") + 
  labs(x = "NMDS1", y = "NMDS2") +  
  custom_theme() + 
  theme(legend.position = "right",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank()) +
  guides(color = guide_legend(override.aes = list(size = 6)))  


# Save the plot to a file
ggsave("3_Figures/FigX_NMDS_zooplankton_V7_genus_fishless.png", width = 7, height = 5, dpi = 400)
```

```{r}
nmds_points <- as.data.frame(nmds$points)
nmds_points$sample_id<-rownames(nmds_points)
nmds_meta<-merge(nmds_points,metadata,by="sample_id")
rm(nmds_points)


lake_colors <- c(
  "Canyon" = "gray88",
  "Eyrie" = "gray88",
  "Lightning" = "gray88",
  "Black Rock" = "#FFBBFF",
  "Footprint" = "#CD96CD",
  "Lost" = "#9696CD",
  "Scott" = "#5D478B",
  "Bullfrog" = "#1E90FF",
  "Middle Gaylor" = "#8EE5EE",
  "Soldier" = "gray88",
  "Skelton" = "gray88",
  "Crescent" = "gray88",
  "Louise" = "#FFA07A",
  "Monogram" = "#EE30A7"
)

nmds_meta<-nmds_meta %>%
        arrange(state,mountain_range, fish, lake_name,bottom_cm) %>%
        group_by(lake_name)%>%
        mutate(fish_present_sample = ifelse(first_stocked_yr>=date_mid_AD_combo | is.na(first_stocked_yr) ==T, "fishless","fish"))  %>%  
        mutate(fish_present_sample = if_else(!is.na(fish_disappear_or_eradicated) & fish_disappear_or_eradicated <= date_mid_AD_combo, "fishless", fish_present_sample)) %>% ungroup()

nmds_meta <- nmds_meta %>%
        mutate(lake_color = lake_colors[lake_name])

# add depth
nmds_meta$scaled_depth<-scale(nmds_meta$bottom_cm)
nmds_meta$scaled_depth<-(nmds_meta$scaled_depth+2.519536)



ggplot() +
  geom_point(data = nmds_meta %>% filter(fish == 0), 
             aes(x = MDS1, y = MDS2, size = scaled_depth, color=lake_name), 
            shape = 16) +  
  geom_point(data = nmds_meta %>% filter(fish == 1), 
             aes(x = MDS1, y = MDS2, size = scaled_depth, color = lake_name), 
             shape = 16) +  
  scale_color_manual(values = lake_colors, name = "Lake") +  
  scale_size_continuous(name = "Scaled Depth", range = c(1, 5), guide = "none") + 
  labs(x = "NMDS1", y = "NMDS2") +  
  custom_theme() + 
  theme(legend.position = "right",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank()) +
  guides(color = guide_legend(override.aes = list(size = 6)))  

ggsave("3_Figures/FigX_NMDS_zooplankton_V7_genus_fish.png", width = 7, height = 5, dpi = 400)

```





V7
```{r}
#nmds <- ps_V7_norm %>% subset_taxa(.,!Family %in% c("Branchiopoda", "Maxillopoda")) %>% tax_glom(., taxrank = "Genus") %>% ordinate(., method = "NMDS", distance="bray")
nmds <- ps_V9_norm %>% subset_taxa(.,!Family %in% c("Branchiopoda", "Maxillopoda")) %>% ordinate(., method = "NMDS", distance="bray")
nmds_points <- as.data.frame(nmds$points)
nmds_points$sample_id<-rownames(nmds_points)
nmds_meta<-merge(nmds_points,metadata,by="sample_id")
rm(nmds_points)


lake_colors <- c("Canyon" = "#b9ceac", "Eyrie" = "darkolivegreen3", "Lightning" = "darkolivegreen", 
                 "Black Rock" = "#FFBBFF", "Footprint" = "#CD96CD", "Lost" = "#9696CD", 
                 "Scott" = "#5D478B", "Bullfrog" = "#1E90FF", "Middle Gaylor" = "#8EE5EE", 
                 "Soldier" = "#4682B4", "Skelton" = "#5F9EA0", "Crescent" = "#EE6363", 
                 "Louise" = "#FFA07A", "Monogram" = "#EE30A7")
                 

nmds_meta<-nmds_meta %>%
        arrange(state,mountain_range, fish, lake_name,bottom_cm) %>%
        group_by(lake_name)%>%
        mutate(fish_present_sample = ifelse(first_stocked_yr>=date_mid_AD_combo | is.na(first_stocked_yr) ==T, "fishless","fish"))  %>%  
        mutate(fish_present_sample = if_else(!is.na(fish_disappear_or_eradicated) & fish_disappear_or_eradicated <= date_mid_AD_combo, "fishless", fish_present_sample)) %>% ungroup()


nmds_meta <- nmds_meta %>%
  mutate(lake_color = lake_colors[lake_name], 
        fish_col = if_else(fish_present_sample == "fish", "black", lake_color))

legend_cols<-unique(nmds_meta[,names(nmds_meta)%in%c("lake_name","lake_color")])


# add depth
nmds_meta$scaled_depth<-scale(nmds_meta$bottom_cm)
nmds_meta$scaled_depth<-(nmds_meta$scaled_depth+2.519536)

# plot
png("3_Figures/FigX_NMDS_phytoplankton_V7_ESV.png", height= 7, width=13, units = "in", res = 400)
#png("3_Figures/FigX_NMDS_phytoplankton_V7_genus.png", height= 7, width=13, units = "in", res = 400)
par(mar=c(4,4,1,10),xpd=TRUE)
plot(nmds_meta$MDS1, nmds_meta$MDS2,pch =21, bg=nmds_meta$lake_color,col=nmds_meta$fish_col,ylab="",xlab="", cex=nmds_meta$scaled_depth)

legend("topright", legend = legend_cols$lake_name, col = legend_cols$lake_color, pch = 21, pt.bg = legend_cols$lake_color, title = "Lake", bty = "n", pt.cex=2,cex = 1.1, inset = c(-0.18, 0))
# 
legend("topright", legend = c("Fish present","Fishless"), col = c("black","white"), pch = 21, pt.bg =   "#FDBF6F", title = "", bty = "n", pt.cex=2,cex = 1.1, inset = c(-.19, 0.6))
 title(xlab="NMDS1", line = 2.5, cex.lab=1.2)
 title(ylab="NMDS2", line = 2.5, cex.lab=1.2)
dev.off()
```

V9
```{r}
#nmds <- ps_V9_norm %>% subset_taxa(.,!Family %in% c("Branchiopoda", "Maxillopoda")) %>% tax_glom(., taxrank = "Genus") %>% ordinate(., method = "NMDS", distance="bray")
nmds <- ps_V9_norm %>% subset_taxa(.,!Family %in% c("Branchiopoda", "Maxillopoda")) %>% ordinate(., method = "NMDS", distance="bray")
nmds_points <- as.data.frame(nmds$points)
nmds_points$sample_id<-rownames(nmds_points)
nmds_meta<-merge(nmds_points,metadata,by="sample_id")
rm(nmds_points)


lake_colors <- c("Canyon" = "#b9ceac", "Eyrie" = "darkolivegreen3", "Lightning" = "darkolivegreen", 
                 "Black Rock" = "#FFBBFF", "Footprint" = "#CD96CD", "Lost" = "#9696CD", 
                 "Scott" = "#5D478B", "Bullfrog" = "#1E90FF", "Middle Gaylor" = "#8EE5EE", 
                 "Soldier" = "#4682B4", "Skelton" = "#5F9EA0", "Crescent" = "#EE6363", 
                 "Louise" = "#FFA07A", "Monogram" = "#EE30A7")
                 

nmds_meta<-nmds_meta %>%
        arrange(state,mountain_range, fish, lake_name,bottom_cm) %>%
        group_by(lake_name)%>%
        mutate(fish_present_sample = ifelse(first_stocked_yr>=date_mid_AD_combo | is.na(first_stocked_yr) ==T, "fishless","fish"))  %>%  
        mutate(fish_present_sample = if_else(!is.na(fish_disappear_or_eradicated) & fish_disappear_or_eradicated <= date_mid_AD_combo, "fishless", fish_present_sample)) %>% ungroup()


nmds_meta <- nmds_meta %>%
  mutate(lake_color = lake_colors[lake_name], 
        fish_col = if_else(fish_present_sample == "fish", "black", lake_color))

legend_cols<-unique(nmds_meta[,names(nmds_meta)%in%c("lake_name","lake_color")])


# add depth
nmds_meta$scaled_depth<-scale(nmds_meta$bottom_cm)
nmds_meta$scaled_depth<-(nmds_meta$scaled_depth+2.519536)

# plot
png("3_Figures/FigX_NMDS_phytoplankton_V9_ESV.png", height= 7, width=13, units = "in", res = 400)
#png("3_Figures/FigX_NMDS_phytoplankton_V9_genus.png", height= 7, width=13, units = "in", res = 400)
par(mar=c(4,4,1,10),xpd=TRUE)
plot(nmds_meta$MDS1, nmds_meta$MDS2,pch =21, bg=nmds_meta$lake_color,col=nmds_meta$fish_col,ylab="",xlab="", cex=nmds_meta$scaled_depth)

legend("topright", legend = legend_cols$lake_name, col = legend_cols$lake_color, pch = 21, pt.bg = legend_cols$lake_color, title = "Lake", bty = "n", pt.cex=2,cex = 1.1, inset = c(-0.18, 0))
# 
legend("topright", legend = c("Fish present","Fishless"), col = c("black","white"), pch = 21, pt.bg =   "#FDBF6F", title = "", bty = "n", pt.cex=2,cex = 1.1, inset = c(-.19, 0.6))
 title(xlab="NMDS1", line = 2.5, cex.lab=1.2)
 title(ylab="NMDS2", line = 2.5, cex.lab=1.2)
dev.off()
```

